%h3 Load per cpu, 1min average

.chart_container  
  .chart_load
  
%h3 Used memory (%)

.chart_container
  .y_axis.mem
  .chart.mem
  .legend.mem

%h3 IO reads (MB/sec)

.chart_container
  .y_axis.ioread
  .chart.ioread
  .legend.ioread

%h3 IO writes (MB/sec)

.chart_container
  .y_axis.iowrite
  .chart.iowrite
  .legend.iowrite

:javascript
  // var palette = new Rickshaw.Color.Palette();

  // Load graph
  // var graph = new Rickshaw.Graph( {
  //   element: document.querySelector(".chart.load"),
  //     width: 1000,
  //       height: 300,
  //       interpolation: "linear",
  //       renderer: "line",
  //       series: #{@load_data}
  // } );
  // var axes = new Rickshaw.Graph.Axis.Time( {
  //   graph: graph,
  //   orientation: "bottom"
  // } );
  // var y_axis = new Rickshaw.Graph.Axis.Y( {
  //   graph: graph,
  //   orientation: "left",
  //   tickFormat: Rickshaw.Fixtures.Number.formatKMBT,
  //   element: document.querySelector(".y_axis.load")
  // } );

  // var legend = new Rickshaw.Graph.Legend( {
  //   element: document.querySelector(".legend.load"),
  //     graph: graph
  // } );
  // graph.render();

  // var hoverDetail = new Rickshaw.Graph.HoverDetail({
  //   graph: graph
  // });

  // var highlighter = new Rickshaw.Graph.Behavior.Series.Highlight( {
  //   graph: graph,
  //   legend: legend
  // });


  // Memory percentage graph
  palette = new Rickshaw.Color.Palette();

  graph = new Rickshaw.Graph( {
    element: document.querySelector(".chart.mem"),
      width: 1000,
      height: 300,
      interpolation: "linear",
      renderer: "line",
      series: #{@mem_data}
  } );
  axes = new Rickshaw.Graph.Axis.Time( { graph: graph } );
  y_axis = new Rickshaw.Graph.Axis.Y( {
    graph: graph,
    orientation: "left",
    tickFormat: Rickshaw.Fixtures.Number.formatKMBT,
    element: document.querySelector(".y_axis.mem"),
  } );

  legend = new Rickshaw.Graph.Legend( {
    element: document.querySelector(".legend.mem"),
    graph: graph
  } );
  graph.render();

  var hoverDetail = new Rickshaw.Graph.HoverDetail({
    graph: graph
  });

  var highlighter = new Rickshaw.Graph.Behavior.Series.Highlight( {
    graph: graph,
    legend: legend
  });

  // IO read graph
  palette = new Rickshaw.Color.Palette();

  graph = new Rickshaw.Graph( {
    element: document.querySelector(".chart.ioread"),
    width: 1000,
    height: 300,
    interpolation: "linear",
    renderer: "line",
    series: #{@ioread_data}
  } );
  axes = new Rickshaw.Graph.Axis.Time( { graph: graph } );
  y_axis = new Rickshaw.Graph.Axis.Y( {
    graph: graph,
    orientation: "left",
    tickFormat: Rickshaw.Fixtures.Number.formatKMBT,
    element: document.querySelector(".y_axis.ioread"),
  } );

  legend = new Rickshaw.Graph.Legend( {
    element: document.querySelector(".legend.ioread"),
    graph: graph
  } );
  graph.render();

  var hoverDetail = new Rickshaw.Graph.HoverDetail({
    graph: graph
  });

  var highlighter = new Rickshaw.Graph.Behavior.Series.Highlight( {
    graph: graph,
    legend: legend
  });

  // IO write graph
  palette = new Rickshaw.Color.Palette();
  graph = new Rickshaw.Graph( {
    element: document.querySelector(".chart.iowrite"),
    width: 1000,
    height: 300,
    interpolation: "linear",
    renderer: "line",
    series: #{@iowrite_data}
  } );
  axes = new Rickshaw.Graph.Axis.Time( { graph: graph } );
  y_axis = new Rickshaw.Graph.Axis.Y( {
    graph: graph,
    orientation: "left",
    tickFormat: Rickshaw.Fixtures.Number.formatKMBT,
    element: document.querySelector(".y_axis.iowrite"),
  } );

  legend = new Rickshaw.Graph.Legend( {
    element: document.querySelector(".legend.iowrite"),
    graph: graph
  } );
  graph.render();

  var hoverDetail = new Rickshaw.Graph.HoverDetail({
    graph: graph
  });

  var highlighter = new Rickshaw.Graph.Behavior.Series.Highlight( {
    graph: graph,
    legend: legend
  });


  /**
     * Highcharts plugin for setting a lower opacity for other series than the one that is hovered
     * in the legend
     */
  (function (Highcharts) {
      var each = Highcharts.each;
      
      Highcharts.wrap(Highcharts.Legend.prototype, 'renderItem', function (proceed, item) {
          
          proceed.call(this, item);
          
          
          var isPoint = !!item.series,
              collection = isPoint ? item.series.points : this.chart.series,
              groups = isPoint ? ['graphic'] : ['group', 'markerGroup'],
              element = item.legendGroup.element;
          
          element.onmouseover = function () {
             each(collection, function (seriesItem) {
                  if (seriesItem !== item) {
                      each(groups, function (group) {
                          seriesItem[group].animate({
                              opacity: 0.25
                          }, {
                              duration: 150
                          });
                      });
                  }
              });
          }
          element.onmouseout = function () {
             each(collection, function (seriesItem) {
                  if (seriesItem !== item) {
                      each(groups, function (group) {
                          seriesItem[group].animate({
                              opacity: 1
                          }, {
                              duration: 50
                          });
                      });
                  }
              });
          }           
          
      });
  }(Highcharts));

  $(function () {
    var seriesOptions = [],
        seriesCounter = 0,        
        systems = #{@load_data}

        createChart = function () {

            $('.chart_load').highcharts('StockChart', {
                chart: {
                  events: {
                    load: function(event) {
                      // modify the legend symbol from a rect to a line
                      $('.highcharts-legend-item path').attr('stroke-width', '15');
                    }
                  }
                },    
                legend: {
                  enabled: true,
                  align: 'right',
                  verticalAlign: 'top',
                  layout: 'vertical',
                  itemMarginTop: 10,
                  itemMarginBottom: 10,
                  symbolWidth: 20
                },
                rangeSelector: {
                    buttons: [{
                        count: 15,
                        type: 'minute',
                        text: '10 M'
                    }, {
                        count: 1,
                        type: 'hour',
                        text: '1 H'
                    }, {
                        count: 12,
                        type: 'hour',
                        text: '12 H'
                    }, {
                        count: 1,
                        type: 'day',
                        text: '1 Day'
                    }, {
                        count: 1,
                        type: 'month',
                        text: '1 Mon'
                    }, {
                        count: 1,
                        type: 'year',
                        text: '1 Y'
                    },{
                        type: 'all',
                        text: 'All'
                    }],
                    inputEnabled: false,
                    selected: 6
                },

                yAxis: {
                    labels: {
                        formatter: function () {
                            return (this.value > 0 ? ' + ' : '') + this.value*100 + '%';
                        }
                    },
                    plotLines: [{
                        value: 0,
                        width: 2,
                        color: 'silver'
                    }],
                    min: 0 
                },

          

                // tooltip: {
                //     pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}%</b><br/>',
                //     valueDecimals: 2
                // },

                 tooltip: {
                   enabled: true,
                   formatter:function(){
                      var tag = '<span>' +new Date(this.points[0].x).toUTCString()+'<br/></span>';
                      console.log(this)
                      for (var i in this.points) {
                        point = this.points[i];
                        tag += '<span style="color:'+point.series.color+'">'+point.series.name+'</span>: <b>'+Highcharts.numberFormat(point.y*100, 2)+'%</b><br/>';                     
                      }                      
                     return tag
                   }
                 },

                series: seriesOptions
            });
        };

    $.each(systems, function (i, system) {
      seriesOptions[i] = {
          name: system.name,
          data: system.data,
          color: system.color,
          marker : {symbol : 'square' }
      };

   
      seriesCounter += 1;

      if (seriesCounter === systems.length) {
          createChart();
      }
   
    });
  });

    /**
   * Dark theme for Highcharts JS
   * @author Torstein Honsi
   */

  // Load the fonts
  Highcharts.createElement('link', {
     href: '//fonts.googleapis.com/css?family=Unica+One',
     rel: 'stylesheet',
     type: 'text/css'
  }, null, document.getElementsByTagName('head')[0]);

  Highcharts.theme = {
     colors: ["#2b908f", "#90ee7e", "#f45b5b", "#7798BF", "#aaeeee", "#ff0066", "#eeaaee",
        "#55BF3B", "#DF5353", "#7798BF", "#aaeeee"],
     chart: {
        backgroundColor: {
           linearGradient: { x1: 0, y1: 0, x2: 1, y2: 1 },
           stops: [
              [0, '#2a2a2b'],
              [1, '#3e3e40']
           ]
        },
        style: {
           fontFamily: "'Unica One', sans-serif"
        },
        plotBorderColor: '#606063'
     },
     title: {
        style: {
           color: '#E0E0E3',
           textTransform: 'uppercase',
           fontSize: '20px'
        }
     },
     subtitle: {
        style: {
           color: '#E0E0E3',
           textTransform: 'uppercase'
        }
     },
     xAxis: {
        gridLineColor: '#707073',
        labels: {
           style: {
              color: '#E0E0E3'
           }
        },
        lineColor: '#707073',
        minorGridLineColor: '#505053',
        tickColor: '#707073',
        title: {
           style: {
              color: '#A0A0A3'

           }
        }
     },
     yAxis: {
        gridLineColor: '#707073',
        labels: {
           style: {
              color: '#E0E0E3'
           }
        },
        lineColor: '#707073',
        minorGridLineColor: '#505053',
        tickColor: '#707073',
        tickWidth: 1,
        title: {
           style: {
              color: '#A0A0A3'
           }
        }
     },
     tooltip: {
        backgroundColor: 'rgba(0, 0, 0, 0.85)',
        style: {
           color: '#F0F0F0'
        }
     },
     plotOptions: {
        series: {
           dataLabels: {
              color: '#B0B0B3'
           },
           marker: {
              lineColor: '#333'
           }
        },
        boxplot: {
           fillColor: '#505053'
        },
        candlestick: {
           lineColor: 'white'
        },
        errorbar: {
           color: 'white'
        }
     },
     legend: {
        itemStyle: {
           color: '#E0E0E3'
        },
        itemHoverStyle: {
           color: '#FFF'
        },
        itemHiddenStyle: {
           color: '#606063'
        }
     },
     credits: {
        style: {
           color: '#666'
        }
     },
     labels: {
        style: {
           color: '#707073'
        }
     },

     drilldown: {
        activeAxisLabelStyle: {
           color: '#F0F0F3'
        },
        activeDataLabelStyle: {
           color: '#F0F0F3'
        }
     },

     navigation: {
        buttonOptions: {
           symbolStroke: '#DDDDDD',
           theme: {
              fill: '#505053'
           }
        }
     },

     // scroll charts
     rangeSelector: {
        buttonTheme: {
           fill: '#505053',
           stroke: '#000000',
           style: {
              color: '#CCC'
           },
           states: {
              hover: {
                 fill: '#707073',
                 stroke: '#000000',
                 style: {
                    color: 'white'
                 }
              },
              select: {
                 fill: '#000003',
                 stroke: '#000000',
                 style: {
                    color: 'white'
                 }
              }
           }
        },
        inputBoxBorderColor: '#505053',
        inputStyle: {
           backgroundColor: '#333',
           color: 'silver'
        },
        labelStyle: {
           color: 'silver'
        }
     },

     navigator: {
        handles: {
           backgroundColor: '#666',
           borderColor: '#AAA'
        },
        outlineColor: '#CCC',
        maskFill: 'rgba(255,255,255,0.1)',
        series: {
           color: '#7798BF',
           lineColor: '#A6C7ED'
        },
        xAxis: {
           gridLineColor: '#505053'
        }
     },

     scrollbar: {
        barBackgroundColor: '#808083',
        barBorderColor: '#808083',
        buttonArrowColor: '#CCC',
        buttonBackgroundColor: '#606063',
        buttonBorderColor: '#606063',
        rifleColor: '#FFF',
        trackBackgroundColor: '#404043',
        trackBorderColor: '#404043'
     },

     // special colors for some of the
     legendBackgroundColor: 'rgba(0, 0, 0, 0.5)',
     background2: '#505053',
     dataLabelsColor: '#B0B0B3',
     textColor: '#C0C0C0',
     contrastTextColor: '#F0F0F3',
     maskColor: 'rgba(255,255,255,0.3)'
  };

  // Apply the theme
  Highcharts.setOptions(Highcharts.theme);